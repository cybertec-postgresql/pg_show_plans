-- explain output on PG12/13 is missing "Async Capable"
select setting::int < 140000 as pg12_13 from pg_settings where name = 'server_version_num';
 pg12_13 
---------
 f
(1 row)

-- json output
set pg_show_plans.plan_format = 'json';
ERROR:  parameter "pg_show_plans.plan_format" cannot be changed without restarting the server
show pg_show_plans.plan_format;
 pg_show_plans.plan_format 
---------------------------
 text
(1 row)

select * from nest();
 level | plan 
-------+------
(0 rows)

-- yaml output
set pg_show_plans.plan_format = 'yaml';
ERROR:  parameter "pg_show_plans.plan_format" cannot be changed without restarting the server
show pg_show_plans.plan_format;
 pg_show_plans.plan_format 
---------------------------
 text
(1 row)

select * from nest();
 level | plan 
-------+------
(0 rows)

-- xml output
set pg_show_plans.plan_format = 'xml';
ERROR:  parameter "pg_show_plans.plan_format" cannot be changed without restarting the server
show pg_show_plans.plan_format;
 pg_show_plans.plan_format 
---------------------------
 text
(1 row)

select * from nest();
 level | plan 
-------+------
(0 rows)

-- check plan format after reconnect
\c
show pg_show_plans.plan_format;
 pg_show_plans.plan_format 
---------------------------
 text
(1 row)

